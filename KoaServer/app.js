!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=18)}([function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,u)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(11),r=n(8);class s{constructor(){this.fs=n(13),this.env="production",this.configName="localConfig",this.init=(()=>i(this,void 0,void 0,function*(){let e=yield this.getRedisData();e||(e=JSON.parse(this.fs.readFileSync(o.resolve(__dirname,"./localConfig."+this.env+".json")).toString()),r.default.set(this.configName,JSON.stringify(e))),this.initConfig(e),console.log("config 数据初始化成功"),this.IntervalUpdate(6e4)})),this.initConfig=(e=>{this.config=e,this.error=e.error,this.routes=e.routes,this.ignoreUrls=e.ignoreUrls,this.redis=e.redis,this.cookie=e.cookie,this.SSO=e.SSO,this.weixins=e.weixins}),this.getRedisData=(()=>i(this,void 0,void 0,function*(){let e,t=yield r.default.get(this.configName);return t&&(e=JSON.parse(t)),e})),this.update=(()=>i(this,void 0,void 0,function*(){return yield this.getRedisData()})),this.IntervalUpdate=(e=>{setInterval(()=>i(this,void 0,void 0,function*(){let e=yield this.update();this.initConfig(e),console.log("redis 配置文件已更新")}),e)}),this.setRouterData=((e,t)=>i(this,void 0,void 0,function*(){let n=yield this.getRedisData();n&&(n.routes[e]=t,r.default.set(this.configName,n),this.initConfig(n))}))}}let u=new s;t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0).default.error;class o{constructor(){this.resultCode=0,this.resultMessage="success",this.result={},this.getValue=this.getValue.bind(this)}success(e){return this.resultCode=0,this.resultMessage="success",this.result=e,this.getValue()}error(e,t){return this.resultCode=e,this.resultMessage=i[e]||t,this.getValue()}getValue(){return{code:this.resultCode,message:this.resultMessage,result:this.result}}}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(3);n(26);var o=n(27);class r{constructor(e,t=5e3){this.headers={charset:"utf-8",client_version:"1.0",channel:"node"},this.domain=e,this.timeout=t}setDomain(e){this.domain=e}setTimeout(e){this.timeout=e}setHeaders(e={client_version:"1.0",channel:"node"}){this.headers=Object.assign({charset:"utf-8",client_version:"1.0",channel:"node"},e)}setVersion(e){this.headers.client_version=e}getData(e,t={},n="GET",o,r="json",s){"GET"===(n=n.toLocaleUpperCase())&&i.size(t)>0&&(e+="?"+l(t)),o=u(r,Object.assign({},this.headers,o));let d=a(r,t);return c(s||this.timeout,fetch(this.domain+e,{method:n,headers:o,body:"GET"===n?void 0:d}).then(t=>(console.log("fetxhUrl:"+e),t.json())).catch(e=>{console.log(e)}))}}const s=n(28),u=function(e,t){return Object.assign({},t,s[e])},a=function(e,t){let n;switch(e){case"json":n=JSON.stringify(t);break;case"form-data":n=new o;for(let e in t)n.append(e,t[e]);break;default:n=t}return n},c=function(e,t){return new Promise((n,i)=>{const o=setTimeout(()=>{i(new Error("promise timeout"))},e);t.then(e=>{clearTimeout(o),n(e)},e=>{clearTimeout(o),i(e)})})},l=function(e,t={":":"=",",":"&"}){let n="";for(var i in e)n+=i+"="+encodeURI(e[i])+"&";return n.substring(-1,n.length-1)};t.default=r},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("koa-router")},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,u)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(8),r=n(7),s=n(1),u=n(4),a=n(0),c=new s.default,l=a.default,d=l.ignoreUrls,f="YYYY-MM-DD hh:mm:ss:SSS",h=(new r.default,l.SSO);class p{constructor(e=h){this.verify=this.verify.bind(this),this.setCookie=this.setCookie.bind(this),this.saveTokenInfo=this.saveTokenInfo.bind(this),this.SSO=e}setCookie(e,t,n,i){e.cookies.set(t,!0===this.SSO?i:n,l.cookie)}saveTokenInfo(e,t,n,i){let r=Object.assign({},n,{token:t,date:u().format(f)}),s=e+":"+(!0===this.SSO?i:t);o.default.set(s,JSON.stringify(r)),o.default.expire(s,l.redis.expiration)}getTokenInfo(e){return o.default.get(e)}_verifyToken(e){return i(this,void 0,void 0,function*(){let t=yield this.getTokenInfo(e);return t&&JSON.parse(t)||t})}getTokenInfoByKey(e,t){return i(this,void 0,void 0,function*(){let n=yield this.getTokenInfo(this.getTokenKey(t)+":"+e);return JSON.parse(n)||!1})}getTokenKey(e){let t=e.originalUrl.split("/")[2];return l.routes[t]&&l.routes[t].tokenKey||l.routes.qbii.tokenKey}getToken(e){let t=e.cookies.get("token")||!1;if(t)return this.getTokenKey(e)+":"+t}verifyToken(e){return i(this,void 0,void 0,function*(){let t=this.getToken(e);return!!(yield this._verifyToken(t))})}verify(e,t){return i(this,void 0,void 0,function*(){let n=this.getToken(e),{url:i}=e;if(i=i.split("?")[0],d[i])return t();if(n){let i=yield this._verifyToken(n);return i?(e.state.userInfo=i,t()):(c.error(200,"登录过期"),void(e.body=c.getValue()))}return c.error(200,"未登陆"),void(e.body=c.getValue())})}}t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(9),o=n(4),r="啊哈你说这个是啥，其实就是Hmac的message，干啥用的？防止你硬解的。";class s{constructor(){}build(e){return i.createHmac("md5",r).update(e+o().format("YYYY-MM-DD hh:mm:ss:SSS")).digest("hex")}decipher(e){}}t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let i=new(n(19))(n(12).redis);t.default=i},function(e,t){e.exports=require("crypto")},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,u)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});let o=new(n(29).default)("configInfo");class r{constructor(){}getData(){return i(this,void 0,void 0,function*(){return yield o.getDataAsync()})}getWeiXinInfo(e){return i(this,void 0,void 0,function*(){return(yield this.getData()).weixins[e]||{}})}saveWeiXinInfo(e,t){return i(this,void 0,void 0,function*(){let n=(yield this.getData())||{weixins:{}},i=n.weixins&&n.weixins[e]&&n.weixins||{[e]:{}};for(let n in t)i[e][n]=t[n];let r=Object.assign({},n.weixins,i);return n.weixins=r,o.saveData(n)})}}t.default=r},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(11),o=n(13),r=JSON.parse(o.readFileSync(i.resolve(__dirname,"./sysConfig.production.json")).toString());e.exports=r},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("winston")},function(e,t){e.exports=require("winston-daily-rotate-file")},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,u)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(1),r=n(2),s=n(17),u=n(6),a=n(7),c=n(10),l=n(0).default.routes.item,d=new r.default(l.domain,l.timeout);d.setDomain(l.domain),d.setTimeout(l.timeout);const f=new a.default,h=new u.default(!0);let p=new s.default("item");t.login=function(e,n){return i(this,void 0,void 0,function*(){let n=new o.default,{code:i}=e.query;if(yield h.verifyToken(e))return void(e.body=n.success({}));let r=yield p.userTokenGet(i);if(r&&void 0==r.errcode){let i={},o=yield p.userTokenRefresh(r.refresh_token),s=yield h.getTokenInfoByKey(o.openid,e);if(s)return h.setCookie(e,"token",s.token,s.openid),void(e.body=n.success({}));let u=yield p.userInfoGetByGuanZhu(o.openid),a=yield p.userInfoGet(o.openid,o.access_token);if(i=u,void 0==u.errcode&&0===u.subscribe&&(i=a,a.errcode&&48001===a.errcode))return void(e.body=n.error(201,"此用户未关注,也没有授权，需要跳转到授权界面"));let c=yield t.sendUserInfo(o.openid,o.access_token,i);if(c&&o.openid){let{userId:t}={userId:c},i=f.build(t);h.saveTokenInfo(h.getTokenKey(e),i,Object.assign({openid:o.openid,access_token:o.access_token},{userId:t}),o.openid),h.setCookie(e,"token",i,t),e.body=n.success({})}else n.success(i),e.body=n.error(1,"获取用户信息失败");console.log("resultRefresh",o),console.log("userInfo",i)}else e.body=n.error(1,"获取用户信息失败")})},t.sendUserInfo=((e,t,n)=>i(this,void 0,void 0,function*(){let e=yield d.getData("/user/postWxUser",n,"POST");return!(!e||1e3!==e.responseCode)&&e.data})),t.getWXInfo=function(e,t){return i(this,void 0,void 0,function*(){let t=yield p.infoGet(),n=new o.default;e.body=n.success({appid:t.appid})})},t.getWeiXinInfo=(()=>i(this,void 0,void 0,function*(){let e=yield d.getData("/config/wxConfig",{},"GET");if(e&&1e3===e.responseCode){let t=new c.default;return t.saveWeiXinInfo("item",{appid:e.data.appID,secret:e.data.appSecret,access_token:e.data.accessToken,jsapi_ticket:e.data.jsapiTicket}),!0}return console.log("获取 有好物的微信配置异常...",e),!1})),t.checkLogin=function(e,t){let n=new o.default;e.body=n.success({})}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,u)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),r=n(10),s=n(30);o.default.weixins;let u=new r.default;class a{constructor(e){this.key=e}getParams(e,t){return i(this,void 0,void 0,function*(){let n={},{key:i}=this,o=yield u.getWeiXinInfo(i);return e.map(e=>{n[e]=o[e]}),Object.assign({},n,t)})}infoGet(){return i(this,void 0,void 0,function*(){let{key:e}=this;return yield u.getWeiXinInfo(e)})}userTokenGet(e){return i(this,void 0,void 0,function*(){return s.all("/api/weixin/user/token",yield this.getParams(["appid","secret"],{code:e,grant_type:"authorization_code"}))})}userTokenRefresh(e){return i(this,void 0,void 0,function*(){return s.all("/api/weixin/user/tokenRefresh",yield this.getParams(["appid"],{refresh_token:e,grant_type:"refresh_token"}))})}userInfoGet(e,t){return i(this,void 0,void 0,function*(){return s.all("/api/weixin/user/info",yield this.getParams([],{openid:e,access_token:t,lang:"zh_CN"}))})}userInfoGetByGuanZhu(e){return i(this,void 0,void 0,function*(){return s.all("/api/weixin/user/info/guanzhu",yield this.getParams(["access_token"],{openid:e,lang:"zh_CN"}))})}configTokenGet(){return i(this,void 0,void 0,function*(){return s.all("/api/weixin/config/token",yield this.getParams(["appid","secret"],{grant_type:"client_credential"}))})}ticketJsGet(){return i(this,void 0,void 0,function*(){return s.all("/api/weixin/config/jsTicket",yield this.getParams(["access_token"],{type:"jsapi"}))})}menuGet(e){return i(this,void 0,void 0,function*(){return s.all("/api/weixin/menu/get",yield this.getParams([],{access_token:e}))})}verify(e){return i(this,void 0,void 0,function*(){return void 0==(yield this.menuGet(e)).errcode})}}t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(0).default.init().then(()=>{let e=n(20);console.log("初始化App"),e()})},function(e,t){e.exports=require("ioredis")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(3),o=n(21),r=n(22),s=n(1),u=n(6),a=n(23),c=n(24),l=n(25),d=n(31);let f=()=>{const e=n(12),t=n(32),f=n(48);let h=new s.default,p=new u.default,g=new o;g.keys=["im a newer secret","你说是啥 就是啥，呵呵哒"],g.use(a.default()),g.use(d.default()),g.use(f(r({onerror:function(e,t){t.throw("body parse error",422)}}))),g.context.onerror=function(e){null!=e&&(h.error(500,""),this.res.end(JSON.stringify(h.getValue())))},g.use((e,t)=>t().then(()=>{200!==e.status&&(h.error(e.status,""),e.body=h.getValue(),c.default.error("normal","",e.status))}).catch(t=>{console.error(t),h.error(1e3,"超时"),e.body=h.getValue(),c.default.error("error","",t)})),g.on("error",e=>c.default.error("server error",e)),g.use(p.verify),i.each(t,function(e,t){g.use(e.routes()),g.use(e.allowedMethods())}),console.log(e.localServer.port),g.listen(e.localServer.port),l.default()};e.exports=f},function(e,t){e.exports=require("koa")},function(e,t){e.exports=require("koa-bodyparser")},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,u)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(14);n(15);var r=new o.Logger({transports:[new o.transports.File({filename:"request.log"})]});const s=(e=200,t="info")=>{switch(parseInt((e/100).toString(),10)){case 5:return"error";case 4:return"warn";default:return t}};t.default=function(){return function(e,t){return i(this,void 0,void 0,function*(){let{request:n}=e,i="",o=Date.now();try{yield t(),i=e.state.useInfo&&e.state.useInfo.userId||""}catch(t){e.status=500,r.error(t.name,"...",{pid:process.pid,uid:process.getuid(),userId:i,error:Object.assign({},t),time:Date.now()-o+"ms"}),e.throw(t.Message,500),console.error(t)}finally{r[s(e.status)]("request","....",{pid:process.pid,uid:process.getuid(),userId:i,req:{header:e.request.header,ip:n.ip,body:n.body,originalUrl:n.originalUrl,method:n.method},time:Date.now()-o+"ms"})}})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(14);n(15),process.getuid||(process.getuid=(()=>0));var o=new i.Logger({transports:[new i.transports.Console,new i.transports.File({filename:"normal.log",maxsize:10240})]});var r={error:function(e,t,n){return n=Object.assign({},n,{pid:process.pid,uid:process.getuid()}),o.error(e,t,n)},info:function(e,t,n){return console.log(process),n=Object.assign({},n,{pid:process.pid,uid:process.getuid()}),o.info(e,t,n)},warn:function(e,t,n){return n=Object.assign({},n,{pid:process.pid,uid:process.getuid()}),o.warn(e,t,n)}};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(16);t.default=function(){return i.getWeiXinInfo(),""}},function(e,t){e.exports=require("isomorphic-fetch")},function(e,t){e.exports=require("isomorphic-form-data")},function(e,t){e.exports={json:{Accept:"application/json","Content-Type":"application/json"},"form-data":{Accept:"application/json"}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,u)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(8);class r{constructor(e){this.key=e,this.init()}init(){return i(this,void 0,void 0,function*(){return this.data=JSON.stringify(yield this.dataGetFromRedis()),this.data})}dataGetFromRedis(){return i(this,void 0,void 0,function*(){return yield o.default.get(this.key)})}getData(){return this.data}saveData(e){return i(this,void 0,void 0,function*(){let t=this;return o.default.set(this.key,JSON.stringify(e)).then((e,n)=>(console.log("xxxx",e,n),t.init()))})}getDataAsync(){return i(this,void 0,void 0,function*(){return JSON.parse(yield o.default.get(this.key))})}}t.default=r},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,u)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),r=n(0),s=r.default.routes.weixin,u=(r.default.weixins,new o.default(s.domain,s.timeout));u.setDomain(s.domain),u.setTimeout(s.timeout),t.all=function(e,t){return i(this,void 0,void 0,function*(){e=e.replace(s.prefix,"");let n=s.routes[e],i=n.url,o=yield u.getData(i,t,n.method).catch(e=>({errcode:111111,errmsg:"自定义错误，访问失败!"+JSON.stringify(e)}));return console.log("访问微信结果为",o),o})}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,u)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});new(n(1).default);const o=function(e,t){return i(this,void 0,void 0,function*(){let{url:n}=e;n=n.split("?")[0],yield t()})};t.default=function(){return o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let i=[n(33),n(36),n(38),n(41),n(43)];e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(5),o=n(0).default.routes.qbii,r=new i;r.prefix(o.prefix);const s=n(34),u=n(35);r.post("/news/isFinishNews",s.isFinishNews);const a=o.routes;for(var c in a)r.all(c,u.all);e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),o=n(2),r=n(0).default.routes.qbii,s=new o.default(r.domain,r.timeout);s.setDomain(r.domain),s.setTimeout(r.timeout),t.login=function(e,t){let n=new i.default,{userId:o}=e;return s.getData("/api/user/"+o+"/userId",{},"GET").then(t=>{n.success(t),e.body=n.getValue()})},t.news=function(e,t){let n=new i.default;return console.log("userId:",e.state.userInfo.userId),s.getData("/api/news/getNewsList.html",{},"GET").then(t=>{n.success(t),e.body=n.getValue()})},t.isFinishNews=function(e,t){let n=new i.default;return console.log("userId:",e.state.userInfo.userId),s.getData("/api/news/isFinishNews.html",{},"POST").then(t=>{n.success(t),e.body=n.getValue()})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),o=n(2),r=n(3),s=n(0).default.routes.qbii,u=new o.default(s.domain,s.timeout);u.setDomain(s.domain),u.setTimeout(s.timeout),t.all=function(e,t){let n=new i.default,{method:o,header:a}=e.request,c=e._matchedRoute,{userId:l}=e,d=("GET"===o?e.request.query:e.request.body||e.request.fields)||{},f=e.params||{};c=c.replace(s.prefix,"");let h=s.routes[c].url;if(h=r.template(h)(Object.assign({},{userId:l},d,f)),console.log("url:"+h),console.dir(d),h)return u.getData(h,d,o).then(t=>{t&&0===t.returnCode?(n.success(t.data),e.body=n.getValue()):t?(n.error(t.returnCode,t.message),e.body=n.getValue()):(n.error(500),e.body=n.getValue())}).catch(e=>{console.log(e)});n.error(404),e.body=n.getValue()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(5),o=n(0).default.routes.good,r=new i;r.prefix(o.prefix);const s=n(37);r.all("/user/userId",s.login),e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),o=n(2),r=n(7),s=n(6),u=n(0),a=(n(4),new r.default,new s.default,u.default.routes.good),c=(u.default.SSO,new o.default(a.domain,a.timeout));c.setDomain(a.domain),c.setTimeout(a.timeout),t.login=function(e,t){let n=new i.default;return console.log("userId:",e.state.userInfo.userId),c.getData("/api/news/getNewsList.html",{},"GET").then(t=>{n.success(t),e.body=n.getValue()})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(5),o=n(0).default.routes.sys,r=new i;r.prefix(o.prefix);const s=n(39);r.all("/account4Client/login",s.login);const u=n(40);r.post("/news/isFinishNews.html",u.isFinishNews),e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),o=n(2),r=n(7),s=n(6),u=n(0),a=(n(4),new r.default),c=new s.default,l=u.default.routes.sys,d=u.default.SSO,f=new o.default(l.domain,l.timeout);f.setDomain(l.domain),f.setTimeout(l.timeout),t.login=function(e,t){new i.default;let n=c.getToken(e);return c.verifyToken(n).then(n=>{if(!0!==d)return h(e,t);e.body={responseCode:1e3}}).catch(()=>h(e,t))};const h=function(e,t){let n=e.request.body;console.log("?",n);let o=new i.default;return n.st?f.getData("/api/account4Client/login",n,"POST",{},"form-data").then(t=>{if(1e3===t.responseCode){let n=t.data.userId,i=a.build(t.data.userId);c.saveTokenInfo(c.getTokenKey(e),i,{userId:n},n),c.setCookie(e,"token",i,n),e.body=t}else e.body=t}):(o.error(404),void(e.body=o.getValue()))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),o=n(2),r=n(0).default.routes.qbii,s=new o.default(r.domain,r.timeout);s.setDomain(r.domain),s.setTimeout(r.timeout),t.isFinishNews=function(e,t){new i.default;return console.log("userId:",e.state.userInfo.userId),s.getData("/api/news/isFinishNews.html",{},"POST").then(t=>{e.body=t})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(5),o=n(0).default.routes.item,r=new i;r.prefix(o.prefix);const s=n(16),u=n(42);r.get("/user/checkLogin",s.checkLogin);const a=o.routes;for(var c in a)r.all(c,u.all);r.get("/user/login",s.login),r.get("/weixin/info",s.getWXInfo),e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),o=n(2),r=n(0),s=n(3),u=r.default.routes.item,a=new o.default(u.domain,u.timeout);a.setDomain(u.domain),a.setTimeout(u.timeout),t.all=function(e,t){let n=new i.default,{method:o,header:r}=e.request,c=e._matchedRoute,{userId:l}=e.state.userInfo,d=("GET"===o?e.request.query:e.request.body||e.request.fields)||{},f=e.params||{};c=c.replace(u.prefix,"");let h=u.routes[c].url;if(h=s.template(h)(Object.assign({},{userId:l},d,f)),console.log("url:"+h),h)return a.getData(h,d,o).then(t=>{t&&1e3===t.responseCode?(n.success(t.data),e.body=n.getValue()):t?(n.error(t.responseCode,t.message),e.body=n.getValue()):(n.error(500),e.body=n.getValue())}).catch(e=>{console.log(e)});n.error(404),e.body=n.getValue()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(5),o=n(0).default.routes.weixin,r=new i;r.prefix(o.prefix);const s=n(44);r.post("/info/:channel",s.setConfig),r.get("/js/info/:channel",s.getJsInfo),e.exports=r},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,u)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(45),r=n(10),s=n(1),u=n(46),a=n(47),c=n(17),l=n(3);let d=new r.default,f=new a.default;t.buildJsTicket=((e,t)=>i(this,void 0,void 0,function*(){}));const h=function(e){let t=Object.assign({},e);delete t.secret_node;let n=JSON.stringify(t);return f.encryptMd5Normal(n,"天下第一!!!!")===e.secret_node};t.setConfig=((e,t)=>i(this,void 0,void 0,function*(){let t=new s.default,n=e.request.body,i=e.params,o=u.default(n,{access_token:"",appid:"",jsapi_ticket:"",secret:"",time:"",secret_node:""}),r=yield new c.default(i.channel).ticketJsGet();if(console.log(r),l.isObject(o)&&i.channel){let n=h(o);if(!0!==n)return e.body=t.error(1,"呵呵，你加密错了！"),!1;let r=new c.default(i.channel),s=yield r.verify(o.access_token);if(s){let n=(yield d.getWeiXinInfo(i.channel))||{};d.saveWeiXinInfo(i.channel,Object.assign(n,o)),e.body=t.success({})}else e.body=t.error(1,"呵呵！你配置错了")}else e.body=t.error(1,o.toString())})),t.getJsInfo=((e,t)=>i(this,void 0,void 0,function*(){let t=new s.default,n=e.query,i=e.params,r=u.default(n,{url:""});if(l.isObject(r)&&i.channel){r.url.substr(0,r.url.indexOf("#"));let s=yield d.getWeiXinInfo(i.channel),u=o.default(s.jsapi_ticket,n.url);console.info(u),e.body=t.success(Object.assign(u,{appid:s.appid}))}else e.body=t.error(1,r.toString())}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(9);var o=function(){return Math.random().toString(36).substr(2,15)},r=function(){return parseInt(((new Date).getTime()/1e3).toString())+""},s=function(e){var t=Object.keys(e),n={};(t=t.sort()).forEach(function(t){n[t.toLowerCase()]=e[t]});var i="";for(var o in n)i+="&"+o+"="+n[o];return i=i.substr(1)};t.default=function(e,t){var n={jsapi_ticket:e,nonceStr:o(),timestamp:r(),url:t},u=s(n),a=i.createHash("sha1");return a.update(u),n.signature=a.digest("hex"),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let n=[],i={},o=!0;for(let r in t)void 0==e[r]?(n.push(r),o=!1):i[r]=e[r];return o?i:n.join(" 不能为空 ,")+" 不能为空"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(9),o=n(4),r="密码加密啦，呵呵哒，ll|~";class s{constructor(){}encrypt(e,t=!1){let n=e+(!0===t?o().format("YYYY-MM-DD hh:mm:ss:SSS"):"");return i.createHmac("md5",r).update(n).digest("hex")}encryptMd5Normal(e,t){console.log("加密内容:"+e),console.log("加密key:"+t);let n=i.createHmac("md5",t).update(e,"utf8").digest("hex");return console.log("加密成啥样:"+n),n}}t.default=s},function(e,t){e.exports=require("koa-convert")}]);